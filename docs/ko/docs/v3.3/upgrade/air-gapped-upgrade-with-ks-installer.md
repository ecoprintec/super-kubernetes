---
title: ks-installer를 사용한 Air-Gapped 업그레이드
keywords: 'Air-Gapped, upgrade, Super Kubenetes, 3.3.0'
description: 'Use ks-installer and offline package to upgrade Super Kubenetes.'
linkTitle: 'Air-Gapped Upgrade with ks-installer'
weight: 7500
---

ks-installer는 쿠버네티스 클러스터가 [KubeKey](../../installing-on-linux/introduction/kubekey/)에 의해 설정되지 않았고, 클라우드 공급자에 의해 호스팅되거나 자체적으로 생성된 사용자에게 권장됩니다. 이 튜토리얼은 **Super Kubenetes 업그레이드 전용**입니다. 클러스터 운영자는 사전에 쿠버네티스를 업그레이드할 책임이 있습니다.

## 사전 준비

- v3를 실행하는 Super Kubenetes 클러스터가 있어야 합니다. 2.x. Super Kubenetes 버전이 v3.1.x 이하인 경우 먼저 v3.2.x로 업그레이드하세요.
- [ 3.3.0 릴리스 노트](../../../v3.3/release/release-v330/)를 주의 깊게 읽으십시오.
- 중요한 컴포넌트는 미리 백업하십시오.
- Docker 레지스트리. Harbor 또는 기타 Docker 레지스트리가 있어야 합니다. 자세한 내용은 [프라이빗 이미지 레지스트리 준비](../../installing-on-linux/introduction/air-gapped-installation/#step-2-prepare-a-private-image-registry)를 참조하세요.
- Super Kubenetes 3.3.0의 지원되는 쿠버네티스 버전: v1.19.x, v1.20.x, v1.21.x, v1.22.x 및 v1.23.x(테스트 중).

## 1단계: 설치 이미지 준비

Air-Gapped 환경에서 Super Kubenetes를 설치할 때 필요한 모든 이미지가 포함된 이미지 패키지를 미리 준비해야 합니다.

1. 다음 명령을 통해 인터넷에 접속할 수 있는 컴퓨터에서 이미지 목록 파일 `images-list.txt`를 다운로드하세요:

   <article className="highlight">
      <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
         <div className="copy-code-button" title="Copy Code"></div>
         <div className="code-over-div">
            <code>
               <p>
                  curl -L -O <a style="color:#ffffff; cursor:text;">https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/images-list.txt</a>
               </p>
            </code>
         </div>
      </pre>
    </article>

  <div className="notices note">
    <p>Note</p>
    <div>
      이 파일은 다른 모듈을 기반으로 `##+modulename` 아래에 이미지를 나열합니다. 동일한 규칙에 따라 자신의 이미지를 이 파일에 추가할 수 있습니다. 전체 파일을 보려면 [부록](../../installing-on-linux/introduction/air-gapped-installation/#image-list-of-kubesphere-v310)을 참조하십시오.
    </div>
  </div>

2.  `offline-installation-tool.sh`를 다운로드하세요.

    <article className="highlight">
       <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
          <div className="copy-code-button" title="Copy Code"></div>
          <div className="code-over-div">
             <code>
                <p>
                   curl -L -O <a style="color:#ffffff; cursor:text;">https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/offline-installation-tool.sh</a>
                </p>
             </code>
          </div>
       </pre>
    </article>

3.  `.sh` 파일을 실행 가능하게 만드세요.

    <article className="highlight">
       <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
          <div className="copy-code-button" title="Copy Code"></div>
          <div className="code-over-div">
             <code>
                <p>
                   chmod +x offline-installation-tool.sh
                </p>
             </code>
          </div>
       </pre>
    </article>

4.  `./offline-installation-tool.sh -h` 명령을 실행하여 스크립트 사용 방법을 확인할 수 있습니다:

    <article className="highlight">
       <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
          <div className="copy-code-button" title="Copy Code"></div>
          <div className="code-over-div">
             <code>
                <p>
                   root@master:/home/ubuntu# ./offline-installation-tool.sh -h
                   Usage:

                     ./offline-installation-tool.sh <span style="color:#f92672">[</span>-l IMAGES-LIST<span style="color:#f92672">]</span> <span style="color:#f92672">&nbsp;[</span>-d IMAGES-DIR<span style="color:#f92672">]</span> <span style="color:#f92672">&nbsp;[</span>-r PRIVATE-REGISTRY<span style="color:#f92672">]</span> <span style="color:#f92672">&nbsp;[</span>-v KUBERNETES-VERSION <span style="color:#f92672">]</span>

                   Description:
                     -b                     : save kubernetes<span style="color:#e6db74">' binaries.
                     </span><span style="color:#e6db74">  -d IMAGES-DIR          : the dir of files (tar.gz) which generated by <span>`</span>docker save<span>`</span>. default: ./kubesphere-images
                   </span><span style="color:#e6db74">&nbsp;&nbsp;-l IMAGES-LIST         : text file with list of images.
                   </span><span style="color:#e6db74">&nbsp;&nbsp;-r PRIVATE-REGISTRY    : target private registry:port.
                   </span><span style="color:#e6db74">&nbsp;&nbsp;-s                     : save model will be applied. Pull the images in the IMAGES-LIST and save images as a tar.gz file.
                   </span><span style="color:#e6db74">&nbsp;&nbsp;-v KUBERNETES-VERSION  : download kubernetes'</span> binaries. default: v1.17.9
                   &nbsp;&nbsp;-h                     : usage message
                </p>
             </code>
          </div>

       </pre>
    </article>

5.  `offline-installation-tool.sh`에서 이미지를 가져오세요.

    <article className="highlight">
       <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
          <div className="copy-code-button" title="Copy Code"></div>
          <div className="code-over-div">
             <code>
                <p>
                   ./offline-installation-tool.sh -s -l images-list.txt -d ./kubesphere-images
                </p>
             </code>
          </div>
       </pre>
    </article>

  <div className="notices note">
    <p>Note</p>
    <div>
      필요에 따라 이미지를 가져오도록 선택할 수 있습니다. 예를 들어 이미 쿠버네티스 클러스터가 있는 경우 `images-list.text`에서 `##k8s-images` 및 그 아래의 관련 이미지를 삭제할 수 있습니다.
    </div>
  </div>

## 2단계: 프라이빗 레지스트리에 이미지 푸시

패키징된 이미지 파일을 로컬 컴퓨터로 전송하고 다음 명령을 실행하여 레지스트리에 푸시하세요.

<article className="highlight">
   <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
      <div className="copy-code-button" title="Copy Code"></div>
      <div className="code-over-div">
         <code>
            <p>
               ./offline-installation-tool.sh -l images-list.txt -d ./kubesphere-images -r dockerhub.kubekey.local
            </p>
         </code>
      </div>
   </pre>
</article>

<div className="notices note">
   <p>Note</p>
   <div>
   명령에서 도메인 이름은 ` dockerhub.kubekey .local`입니다. 반드시 **자신의 레지스트리 주소**를 사용해야 합니다.
   </div>
</div>

## 3단계: ks-installer 다운로드

온라인 환경에서 기존 쿠버네티스 클러스터에 Super Kubenetes를 설치하는 것과 유사하게, `Super Kubenetes-installer.yaml` 도 다운로드해야 합니다 .

1. 다음 명령을 실행하여 ks-installer를 다운로드하고 설치를 위한 작업상자 역할을 하는 머신으로 전송하세요.

   <article className="highlight">
      <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
         <div className="copy-code-button" title="Copy Code"></div>
         <div className="code-over-div">
            <code>
               <p>
                  curl -L -O <a style="color:#ffffff; cursor:text;">https://github.com/kubesphere/ks-installer/releases/download/v3.3.0/kubesphere-installer.yaml</a>
               </p>
            </code>
         </div>
      </pre>
   </article>

2. `cluster-configuration.yaml`의 `spec.local_registry`에서 프라이빗 이미지 레지스트리를 지정했는지 확인하세요. 기존 클러스터가 Air-Gapped 환경에 설치된 경우, 이 영역이 이미 지정되었을 수 있습니다. 그렇지 않으면 다음 명령을 실행 하여 기존 Super Kubenetes v3.1.x 클러스터의 `cluster- configuration.yaml` 을 편집하고 프라이빗 이미지 레지스트리를 추가하세요:

   <article className="highlight">
      <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
         <div className="copy-code-button" title="Copy Code"></div>
         <div className="code-over-div">
            <code>
               <p>
                  ./kk create config <span style="color:#f92672">[</span>--with-kubernetes version<span style="color:#f92672">]</span> <span style="color:#f92672">&nbsp;[</span>--with-kubesphere version<span style="color:#f92672">]</span> <span style="color:#f92672">&nbsp;[(</span>-f | --file<span style="color:#f92672">)</span> path<span style="color:#f92672">]</span>
               </p>
            </code>
         </div>
      </pre>
   </article>

   예를 들어 `dockerhub.kubekey.local`은 이 튜토리얼의 레지스트리 주소이며, 아래와 같이 `.spec.local_registry` 값으로 사용합니다:

   <article className="highlight">
      <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
         <div className="copy-code-button" title="Copy Code"></div>
         <div className="code-over-div">
            <code>
               <p>
                  <span style="color:#f92672">spec</span>: 
                  <span style="color:#f92672">&nbsp;&nbsp;persistence</span>: 
                  <span style="color:#f92672">&nbsp;&nbsp;&nbsp;&nbsp;storageClass</span>: <span style="color:#e6db74">""</span> 
                  <span style="color:#f92672">&nbsp;&nbsp;authentication</span>: 
                  <span style="color:#f92672">&nbsp;&nbsp;&nbsp;&nbsp;jwtSecret</span>: <span style="color:#e6db74">""</span> 
                  <span style="color:#f92672">&nbsp;&nbsp;local_registry</span>: <span style="color:#ae81ff">dockerhub.kubekey.local</span> <span style="color:#75715e"><span>&nbsp;#</span>&nbsp;Add this line manually; make sure you use your own registry address.</span>
               </p>
            </code>
         </div>
      </pre>
   </article>

3. 편집을 마친 후 `cluster-configuration.yaml` 을 저장하세요. 다음 명령을 사용하여 `ks-installer`를 **자신의 레지스트리 주소**로 바꿉니다:

   <article className="highlight">
      <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
         <div className="copy-code-button" title="Copy Code"></div>
         <div className="code-over-div">
            <code>
               <p>
                  sed -i <span style="color:#e6db74">"s#^\s<span>*</span>image: kubesphere.<span>*</span>/ks-installer:.<span>*</span><span>#</span>        image: dockerhub.kubekey.local/kubesphere/ks-installer:v3.1.0<span>#</span>"</span> kubesphere-installer.yaml
               </p>
            </code>
         </div>
      </pre>
   </article>

  <div className="notices warning">
    <p>Warning</p>
    <div>
      명령에서 `dockerhub.kubekey.local`은 레지스트리 주소입니다. 반드시 자신의 레지스트리 주소를 사용해야 합니다.
    </div>
  </div>

## 4단계: Super Kubenetes 업그레이드

위의 모든 단계가 완료되었는지 확인한 후 다음 명령을 실행하십시오.

<article className="highlight">
   <pre style="color: rgb(248, 248, 242); background: rgb(36, 46, 66); tab-size: 4;">
      <div className="copy-code-button" title="Copy Code"></div>
      <div className="code-over-div">
         <code>
            <p>
               kubectl apply -f Super Kubenetes-installer.yaml
            </p>
         </code>
      </div>
   </pre>
</article>

## 5단계: 설치 확인

설치가 완료되면 다음과 같은 내용을 볼 수 있습니다:

<article className="highlight">
  <pre>
      <div className="copy-code-button" title="Copy Code"></div>
      <div className="code-over-div">
        <code>
          <p>
            <span style="color:#75715e">###########################################################</span> 
            <span style="color:#75715e"><span>#</span><span>#</span><span>#</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Welcome to Super Kubenetes!&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span>#</span><span>#</span><span>#</span></span> 
            <span style="color:#75715e">###########################################################</span> 
            <span></span> 
            <span style="color:#ffffff">Console: <a style="color:#ffffff; cursor:text;">http://192.168.0.2:30880</a></span> 
            <span style="color:#ffffff">Account: admin</span> 
            <span style="color:#ffffff">Password: P@88w0rd</span> 
            <span></span> 
            <span style="color:#ffffff">NOTES：</span> 
            <span style="color:#ffffff">&nbsp;&nbsp;1. After you log into the console, please check the</span> 
            <span style="color:#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;monitoring status of service components in</span> 
            <span style="color:#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the</span>
            <span style="color:#ffffff">&nbsp;<span style="color:#e6db74">"Cluster Management"</span>. If any service is not</span> 
            <span style="color:#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ready, please wait patiently <span style="color:#66d9ef">until</span> all components </span> 
            <span style="color:#ffffff">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;are up and running.</span> 
            <span style="color:#ffffff">&nbsp;&nbsp;2. Please change the default password after login.</span> 
            <span></span> 
            <span style="color:#75715e">###########################################################</span> <span style="color:#ffffff"> 
            <span></span><a style="color:#ffffff; cursor:text;">https://kubesphere.io</a><span></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;20xx-xx-xx xx:xx:xx</span> 
            <span style="color:#75715e">###########################################################</span> <span style="color:#ae81ff">
          </p>
        </code>
      </div>
  </pre>
</article>

이제 기본 계정과 비밀번호 `admin/P@88w0rd`로 `http://{IP}:30880`을 통해 Super Kubenetes의 웹 콘솔에 액세스할 수 있습니다.

<div className="notices note">
  <p>Note</p>
  <div>
    콘솔에 액세스하려면 보안 그룹에서 포트 30880이 열려 있는지 확인하십시오.
  </div>
</div>
